var B=Object.defineProperty;var o=(a,e)=>B(a,"name",{value:e,configurable:!0});var T="registered as custom element";function G(a,e){console.warn(`missing implementation for ${e}(...data) in ${a.__proto__.constructor.name}`)}o(G,"NotImplemented");function w(a){return a.prototype.constructor.name.replace(/([A-Z])([a-z])/g,(e,r,x,t)=>{let i=`${r.toLowerCase()}${x}`;return t>0?`-${i}`:i})}o(w,"getElementTagName");var h=class extends HTMLElement{static{o(this,"CustomElement")}static register(e){if(!e[T]){let r=e.tagName||w(e);return customElements.define(r,e),e[T]=!0,customElements.whenDefined(r)}return Promise.resolve()}static get tagName(){return w(this)}constructor(e={}){super(),customElements.resolveScope||(customElements.resolveScope=function(t){try{return t.getRootNode().host}catch(i){console.warn(i)}return window}),this._options=e;let r={childList:t=>{this.handleChildChanges(Array.from(t.addedNodes),Array.from(t.removedNodes)),this.render()},attributes:t=>{this.handleAttributeChange(t.attributeName,t.oldValue,this.getAttribute(t.attributeName)),this.render()}};this._observer=new MutationObserver(t=>{this.isConnected&&t.forEach(i=>{r[i.type](i)})}),this._observer.observe(this,{childList:!0,attributes:!0});let x={mode:"open"};this._shadow=this.attachShadow(x),this._style=document.createElement("style"),this._style.textContent=this.getStyle(),this._options.header!==!1&&(this._header=document.createElement("header")),this._options.slot!==!1&&this._options.void!==!0&&(this._slot=document.createElement("slot")),this._options.footer!==!1&&(this._footer=document.createElement("footer"))}connectedCallback(){this.render()}handleChildChanges(e,r){this._options.void||G(this,"handleChildChanges")}handleAttributeChange(e,r,x){G(this,"handleAttributeChange")}getStyle(){return""}render(){this._shadow.innerHTML="",this._shadow.append(this._style),this._options.header!==!1&&this._shadow.append(this._header),this._options.slot!==!1&&this._shadow.append(this._slot),this._options.footer!==!1&&this._shadow.append(this._footer)}};var D=["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","transparent","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen","ALICEBLUE","ANTIQUEWHITE","AQUA","AQUAMARINE","AZURE","BEIGE","BISQUE","BLACK","BLANCHEDALMOND","BLUE","BLUEVIOLET","BROWN","BURLYWOOD","CADETBLUE","CHARTREUSE","CHOCOLATE","CORAL","CORNFLOWERBLUE","CORNSILK","CRIMSON","CYAN","DARKBLUE","DARKCYAN","DARKGOLDENROD","DARKGRAY","DARKGREEN","DARKGREY","DARKKHAKI","DARKMAGENTA","DARKOLIVEGREEN","DARKORANGE","DARKORCHID","DARKRED","DARKSALMON","DARKSEAGREEN","DARKSLATEBLUE","DARKSLATEGRAY","DARKSLATEGREY","DARKTURQUOISE","DARKVIOLET","DEEPPINK","DEEPSKYBLUE","DIMGRAY","DIMGREY","DODGERBLUE","FIREBRICK","FLORALWHITE","FORESTGREEN","FUCHSIA","GAINSBORO","GHOSTWHITE","GOLD","GOLDENROD","GRAY","GREEN","GREENYELLOW","GREY","HONEYDEW","HOTPINK","INDIANRED","INDIGO","IVORY","KHAKI","LAVENDER","LAVENDERBLUSH","LAWNGREEN","LEMONCHIFFON","LIGHTBLUE","LIGHTCORAL","LIGHTCYAN","LIGHTGOLDENRODYELLOW","LIGHTGRAY","LIGHTGREEN","LIGHTGREY","LIGHTPINK","LIGHTSALMON","LIGHTSEAGREEN","LIGHTSKYBLUE","LIGHTSLATEGRAY","LIGHTSLATEGREY","LIGHTSTEELBLUE","LIGHTYELLOW","LIME","LIMEGREEN","LINEN","MAGENTA","MAROON","MEDIUMAQUAMARINE","MEDIUMBLUE","MEDIUMORCHID","MEDIUMPURPLE","MEDIUMSEAGREEN","MEDIUMSLATEBLUE","MEDIUMSPRINGGREEN","MEDIUMTURQUOISE","MEDIUMVIOLETRED","MIDNIGHTBLUE","MINTCREAM","MISTYROSE","MOCCASIN","NAVAJOWHITE","NAVY","OLDLACE","OLIVE","OLIVEDRAB","ORANGE","ORANGERED","ORCHID","PALEGOLDENROD","PALEGREEN","PALETURQUOISE","PALEVIOLETRED","PAPAYAWHIP","PEACHPUFF","PERU","PINK","PLUM","POWDERBLUE","PURPLE","REBECCAPURPLE","RED","ROSYBROWN","ROYALBLUE","SADDLEBROWN","SALMON","SANDYBROWN","SEAGREEN","SEASHELL","SIENNA","SILVER","SKYBLUE","SLATEBLUE","SLATEGRAY","SLATEGREY","SNOW","SPRINGGREEN","STEELBLUE","TAN","TEAL","THISTLE","TOMATO","TRANSPARENT","TURQUOISE","VIOLET","WHEAT","WHITE","WHITESMOKE","YELLOW","YELLOWGREEN"],U={aliceblue:"rgb(240, 248, 255)",antiquewhite:"rgb(250, 235, 215)",aqua:"rgb(0, 255, 255)",aquamarine:"rgb(127, 255, 212)",azure:"rgb(240, 255, 255)",beige:"rgb(245, 245, 220)",bisque:"rgb(255, 228, 196)",black:"rgb(0, 0, 0)",blanchedalmond:"rgb(255, 235, 205)",blue:"rgb(0, 0, 255)",blueviolet:"rgb(138, 43, 226)",brown:"rgb(165, 42, 42)",burlywood:"rgb(222, 184, 135)",cadetblue:"rgb(95, 158, 160)",chartreuse:"rgb(127, 255, 0)",chocolate:"rgb(210, 105, 30)",coral:"rgb(255, 127, 80)",cornflowerblue:"rgb(100, 149, 237)",cornsilk:"rgb(255, 248, 220)",crimson:"rgb(220, 20, 60)",cyan:"rgb(0, 255, 255)",darkblue:"rgb(0, 0, 139)",darkcyan:"rgb(0, 139, 139)",darkgoldenrod:"rgb(184, 134, 11)",darkgray:"rgb(169, 169, 169)",darkgreen:"rgb(0, 100, 0)",darkgrey:"rgb(169, 169, 169)",darkkhaki:"rgb(189, 183, 107)",darkmagenta:"rgb(139, 0, 139)",darkolivegreen:"rgb(85, 107, 47)",darkorange:"rgb(255, 140, 0)",darkorchid:"rgb(153, 50, 204)",darkred:"rgb(139, 0, 0)",darksalmon:"rgb(233, 150, 122)",darkseagreen:"rgb(143, 188, 143)",darkslateblue:"rgb(72, 61, 139)",darkslategray:"rgb(47, 79, 79)",darkslategrey:"rgb(47, 79, 79)",darkturquoise:"rgb(0, 206, 209)",darkviolet:"rgb(148, 0, 211)",deeppink:"rgb(255, 20, 147)",deepskyblue:"rgb(0, 191, 255)",dimgray:"rgb(105, 105, 105)",dimgrey:"rgb(105, 105, 105)",dodgerblue:"rgb(30, 144, 255)",firebrick:"rgb(178, 34, 34)",floralwhite:"rgb(255, 250, 240)",forestgreen:"rgb(34, 139, 34)",fuchsia:"rgb(255, 0, 255)",gainsboro:"rgb(220, 220, 220)",ghostwhite:"rgb(248, 248, 255)",gold:"rgb(255, 215, 0)",goldenrod:"rgb(218, 165, 32)",gray:"rgb(128, 128, 128)",green:"rgb(0, 128, 0)",greenyellow:"rgb(173, 255, 47)",grey:"rgb(128, 128, 128)",honeydew:"rgb(240, 255, 240)",hotpink:"rgb(255, 105, 180)",indianred:"rgb(205, 92, 92)",indigo:"rgb(75, 0, 130)",ivory:"rgb(255, 255, 240)",khaki:"rgb(240, 230, 140)",lavender:"rgb(230, 230, 250)",lavenderblush:"rgb(255, 240, 245)",lawngreen:"rgb(124, 252, 0)",lemonchiffon:"rgb(255, 250, 205)",lightblue:"rgb(173, 216, 230)",lightcoral:"rgb(240, 128, 128)",lightcyan:"rgb(224, 255, 255)",lightgoldenrodyellow:"rgb(250, 250, 210)",lightgray:"rgb(211, 211, 211)",lightgreen:"rgb(144, 238, 144)",lightgrey:"rgb(211, 211, 211)",lightpink:"rgb(255, 182, 193)",lightsalmon:"rgb(255, 160, 122)",lightseagreen:"rgb(32, 178, 170)",lightskyblue:"rgb(135, 206, 250)",lightslategray:"rgb(119, 136, 153)",lightslategrey:"rgb(119, 136, 153)",lightsteelblue:"rgb(176, 196, 222)",lightyellow:"rgb(255, 255, 224)",lime:"rgb(0, 255, 0)",limegreen:"rgb(50, 205, 50)",linen:"rgb(250, 240, 230)",magenta:"rgb(255, 0, 255)",maroon:"rgb(128, 0, 0)",mediumaquamarine:"rgb(102, 205, 170)",mediumblue:"rgb(0, 0, 205)",mediumorchid:"rgb(186, 85, 211)",mediumpurple:"rgb(147, 112, 219)",mediumseagreen:"rgb(60, 179, 113)",mediumslateblue:"rgb(123, 104, 238)",mediumspringgreen:"rgb(0, 250, 154)",mediumturquoise:"rgb(72, 209, 204)",mediumvioletred:"rgb(199, 21, 133)",midnightblue:"rgb(25, 25, 112)",mintcream:"rgb(245, 255, 250)",mistyrose:"rgb(255, 228, 225)",moccasin:"rgb(255, 228, 181)",navajowhite:"rgb(255, 222, 173)",navy:"rgb(0, 0, 128)",oldlace:"rgb(253, 245, 230)",olive:"rgb(128, 128, 0)",olivedrab:"rgb(107, 142, 35)",orange:"rgb(255, 165, 0)",orangered:"rgb(255, 69, 0)",orchid:"rgb(218, 112, 214)",palegoldenrod:"rgb(238, 232, 170)",palegreen:"rgb(152, 251, 152)",paleturquoise:"rgb(175, 238, 238)",palevioletred:"rgb(219, 112, 147)",papayawhip:"rgb(255, 239, 213)",peachpuff:"rgb(255, 218, 185)",peru:"rgb(205, 133, 63)",pink:"rgb(255, 192, 203)",plum:"rgb(221, 160, 221)",powderblue:"rgb(176, 224, 230)",purple:"rgb(128, 0, 128)",rebeccapurple:"rgb(102, 51, 153)",red:"rgb(255, 0, 0)",rosybrown:"rgb(188, 143, 143)",royalblue:"rgb(65, 105, 225)",saddlebrown:"rgb(139, 69, 19)",salmon:"rgb(250, 128, 114)",sandybrown:"rgb(244, 164, 96)",seagreen:"rgb(46, 139, 87)",seashell:"rgb(255, 245, 238)",sienna:"rgb(160, 82, 45)",silver:"rgb(192, 192, 192)",skyblue:"rgb(135, 206, 235)",slateblue:"rgb(106, 90, 205)",slategray:"rgb(112, 128, 144)",slategrey:"rgb(112, 128, 144)",snow:"rgb(255, 250, 250)",springgreen:"rgb(0, 255, 127)",steelblue:"rgb(70, 130, 180)",tan:"rgb(210, 180, 140)",teal:"rgb(0, 128, 128)",thistle:"rgb(216, 191, 216)",tomato:"rgb(255, 99, 71)",transparent:"rgba(0,0,0,0)",turquoise:"rgb(64, 224, 208)",violet:"rgb(238, 130, 238)",wheat:"rgb(245, 222, 179)",white:"rgb(255, 255, 255)",whitesmoke:"rgb(245, 245, 245)",yellow:"rgb(255, 255, 0)",yellowgreen:"rgb(154, 205, 50)",ALICEBLUE:"rgb(240, 248, 255)",ANTIQUEWHITE:"rgb(250, 235, 215)",AQUA:"rgb(0, 255, 255)",AQUAMARINE:"rgb(127, 255, 212)",AZURE:"rgb(240, 255, 255)",BEIGE:"rgb(245, 245, 220)",BISQUE:"rgb(255, 228, 196)",BLACK:"rgb(0, 0, 0)",BLANCHEDALMOND:"rgb(255, 235, 205)",BLUE:"rgb(0, 0, 255)",BLUEVIOLET:"rgb(138, 43, 226)",BROWN:"rgb(165, 42, 42)",BURLYWOOD:"rgb(222, 184, 135)",CADETBLUE:"rgb(95, 158, 160)",CHARTREUSE:"rgb(127, 255, 0)",CHOCOLATE:"rgb(210, 105, 30)",CORAL:"rgb(255, 127, 80)",CORNFLOWERBLUE:"rgb(100, 149, 237)",CORNSILK:"rgb(255, 248, 220)",CRIMSON:"rgb(220, 20, 60)",CYAN:"rgb(0, 255, 255)",DARKBLUE:"rgb(0, 0, 139)",DARKCYAN:"rgb(0, 139, 139)",DARKGOLDENROD:"rgb(184, 134, 11)",DARKGRAY:"rgb(169, 169, 169)",DARKGREEN:"rgb(0, 100, 0)",DARKGREY:"rgb(169, 169, 169)",DARKKHAKI:"rgb(189, 183, 107)",DARKMAGENTA:"rgb(139, 0, 139)",DARKOLIVEGREEN:"rgb(85, 107, 47)",DARKORANGE:"rgb(255, 140, 0)",DARKORCHID:"rgb(153, 50, 204)",DARKRED:"rgb(139, 0, 0)",DARKSALMON:"rgb(233, 150, 122)",DARKSEAGREEN:"rgb(143, 188, 143)",DARKSLATEBLUE:"rgb(72, 61, 139)",DARKSLATEGRAY:"rgb(47, 79, 79)",DARKSLATEGREY:"rgb(47, 79, 79)",DARKTURQUOISE:"rgb(0, 206, 209)",DARKVIOLET:"rgb(148, 0, 211)",DEEPPINK:"rgb(255, 20, 147)",DEEPSKYBLUE:"rgb(0, 191, 255)",DIMGRAY:"rgb(105, 105, 105)",DIMGREY:"rgb(105, 105, 105)",DODGERBLUE:"rgb(30, 144, 255)",FIREBRICK:"rgb(178, 34, 34)",FLORALWHITE:"rgb(255, 250, 240)",FORESTGREEN:"rgb(34, 139, 34)",FUCHSIA:"rgb(255, 0, 255)",GAINSBORO:"rgb(220, 220, 220)",GHOSTWHITE:"rgb(248, 248, 255)",GOLD:"rgb(255, 215, 0)",GOLDENROD:"rgb(218, 165, 32)",GRAY:"rgb(128, 128, 128)",GREEN:"rgb(0, 128, 0)",GREENYELLOW:"rgb(173, 255, 47)",GREY:"rgb(128, 128, 128)",HONEYDEW:"rgb(240, 255, 240)",HOTPINK:"rgb(255, 105, 180)",INDIANRED:"rgb(205, 92, 92)",INDIGO:"rgb(75, 0, 130)",IVORY:"rgb(255, 255, 240)",KHAKI:"rgb(240, 230, 140)",LAVENDER:"rgb(230, 230, 250)",LAVENDERBLUSH:"rgb(255, 240, 245)",LAWNGREEN:"rgb(124, 252, 0)",LEMONCHIFFON:"rgb(255, 250, 205)",LIGHTBLUE:"rgb(173, 216, 230)",LIGHTCORAL:"rgb(240, 128, 128)",LIGHTCYAN:"rgb(224, 255, 255)",LIGHTGOLDENRODYELLOW:"rgb(250, 250, 210)",LIGHTGRAY:"rgb(211, 211, 211)",LIGHTGREEN:"rgb(144, 238, 144)",LIGHTGREY:"rgb(211, 211, 211)",LIGHTPINK:"rgb(255, 182, 193)",LIGHTSALMON:"rgb(255, 160, 122)",LIGHTSEAGREEN:"rgb(32, 178, 170)",LIGHTSKYBLUE:"rgb(135, 206, 250)",LIGHTSLATEGRAY:"rgb(119, 136, 153)",LIGHTSLATEGREY:"rgb(119, 136, 153)",LIGHTSTEELBLUE:"rgb(176, 196, 222)",LIGHTYELLOW:"rgb(255, 255, 224)",LIME:"rgb(0, 255, 0)",LIMEGREEN:"rgb(50, 205, 50)",LINEN:"rgb(250, 240, 230)",MAGENTA:"rgb(255, 0, 255)",MAROON:"rgb(128, 0, 0)",MEDIUMAQUAMARINE:"rgb(102, 205, 170)",MEDIUMBLUE:"rgb(0, 0, 205)",MEDIUMORCHID:"rgb(186, 85, 211)",MEDIUMPURPLE:"rgb(147, 112, 219)",MEDIUMSEAGREEN:"rgb(60, 179, 113)",MEDIUMSLATEBLUE:"rgb(123, 104, 238)",MEDIUMSPRINGGREEN:"rgb(0, 250, 154)",MEDIUMTURQUOISE:"rgb(72, 209, 204)",MEDIUMVIOLETRED:"rgb(199, 21, 133)",MIDNIGHTBLUE:"rgb(25, 25, 112)",MINTCREAM:"rgb(245, 255, 250)",MISTYROSE:"rgb(255, 228, 225)",MOCCASIN:"rgb(255, 228, 181)",NAVAJOWHITE:"rgb(255, 222, 173)",NAVY:"rgb(0, 0, 128)",OLDLACE:"rgb(253, 245, 230)",OLIVE:"rgb(128, 128, 0)",OLIVEDRAB:"rgb(107, 142, 35)",ORANGE:"rgb(255, 165, 0)",ORANGERED:"rgb(255, 69, 0)",ORCHID:"rgb(218, 112, 214)",PALEGOLDENROD:"rgb(238, 232, 170)",PALEGREEN:"rgb(152, 251, 152)",PALETURQUOISE:"rgb(175, 238, 238)",PALEVIOLETRED:"rgb(219, 112, 147)",PAPAYAWHIP:"rgb(255, 239, 213)",PEACHPUFF:"rgb(255, 218, 185)",PERU:"rgb(205, 133, 63)",PINK:"rgb(255, 192, 203)",PLUM:"rgb(221, 160, 221)",POWDERBLUE:"rgb(176, 224, 230)",PURPLE:"rgb(128, 0, 128)",REBECCAPURPLE:"rgb(102, 51, 153)",RED:"rgb(255, 0, 0)",ROSYBROWN:"rgb(188, 143, 143)",ROYALBLUE:"rgb(65, 105, 225)",SADDLEBROWN:"rgb(139, 69, 19)",SALMON:"rgb(250, 128, 114)",SANDYBROWN:"rgb(244, 164, 96)",SEAGREEN:"rgb(46, 139, 87)",SEASHELL:"rgb(255, 245, 238)",SIENNA:"rgb(160, 82, 45)",SILVER:"rgb(192, 192, 192)",SKYBLUE:"rgb(135, 206, 235)",SLATEBLUE:"rgb(106, 90, 205)",SLATEGRAY:"rgb(112, 128, 144)",SLATEGREY:"rgb(112, 128, 144)",SNOW:"rgb(255, 250, 250)",SPRINGGREEN:"rgb(0, 255, 127)",STEELBLUE:"rgb(70, 130, 180)",TAN:"rgb(210, 180, 140)",TEAL:"rgb(0, 128, 128)",THISTLE:"rgb(216, 191, 216)",TOMATO:"rgb(255, 99, 71)",TRANSPARENT:"rgba(0,0,0,0)",TURQUOISE:"rgb(64, 224, 208)",VIOLET:"rgb(238, 130, 238)",WHEAT:"rgb(245, 222, 179)",WHITE:"rgb(255, 255, 255)",WHITESMOKE:"rgb(245, 245, 245)",YELLOW:"rgb(255, 255, 0)",YELLOWGREEN:"rgb(154, 205, 50)"};function S(a,e,r,x,t,I,l){var $,n,f,s,g=r.length,b=r[0].length;if(e<1)throw new Error("degree must be at least 1 (linear)");if(e>g-1)throw new Error("degree must be less than or equal to point count - 1");if(!t)for(t=[],$=0;$<g;$++)t[$]=1;if(t.length<r.length&&(t=t.concat(t.slice(0,e))),x){if(x.length!==g+e+1)throw new Error("bad knot vector length")}else{var x=[];for($=0;$<g+e+1;$++)x[$]=$}x.length===r.length&&(x=x.concat(x.slice(0,e)));var E=[e,x.length-1-e],u=x[E[0]],p=x[E[1]];if(l||(a=a*(p-u)+u),a<u||a>p)throw new Error("out of bounds");for(f=E[0];f<E[1]&&!(a>=x[f]&&a<=x[f+1]);f++);var c=[];for($=0;$<g;$++){for(c[$]=[],n=0;n<b;n++)c[$][n]=r[$][n]*t[$];c[$][b]=t[$]}var O;for(s=1;s<=e+1;s++)for($=f;$>f-e-1+s;$--)for(O=(a-x[$])/(x[$+e+1-s]-x[$]),n=0;n<b+1;n++)c[$][n]=(1-O)*c[$-1][n]+O*c[$][n];var I=I||[];for($=0;$<b;$++)I[$]=c[f][$]/c[f][b];return I}o(S,"interpolate");var d=3,A=class{static{o(this,"BSpline")}constructor(e,r=!0){this.points=e,this.points=e.map(x=>x instanceof Array?x:[x.x,x.y]),this.formKnots(r),this.formWeights()}getLUT(e=100){let r=e-1;return[...new Array(e)].map((x,t)=>{let i=S(t/r,d,this.points,this.knots,this.weights);return{x:i[0],y:i[1]}})}formKnots(e=!1){if(!e)return this.formUniformKnots();let r=[],x=this.points.length,t=x-d;for(let i=1;i<x-d;i++)r.push(i+d);for(let i=0;i<=d;i++)r=[d].concat(r);for(let i=0;i<=d;i++)r.push(t+d);return this.knots=r}formUniformKnots(){return this.knots=[...new Array(this.points.length+d+1)].map((e,r)=>r)}formWeights(){return this.weights=this.points.map(e=>1)}};var L=class{static{o(this,"Point")}constructor(e,r){this.x=e,this.y=r}},N=class extends L{static{o(this,"Circle")}constructor(e,r,x){super(e,r),this.r=x}};var m=class a{static{o(this,"Vector")}constructor(e,r,x){arguments.length===1&&(x=e.z,r=e.y,e=e.x),this.x=e,this.y=r,x!==void 0&&(this.z=x)}dist(e,r,x=0){r!==void 0&&(e={x:e,y:r,z:x});let t=0;t+=(this.x-e.x)**2,t+=(this.y-e.y)**2;let i=this.z?this.z:0,l=e.z?e.z:0;return t+=(i-l)**2,t**.5}normalize(e){let r=this.dist(0,0,0);return new a(e*this.x/r,e*this.y/r,e*this.z/r)}getAngle(){return-Math.atan2(this.y,this.x)}reflect(e){let r=new a(e.x-this.x,e.y-this.y);return e.z!==void 0&&(r.z=e.z,this.z!==void 0&&(r.z-=this.z)),this.subtract(r)}add(e){let r=new a(this.x+e.x,this.y+e.y);return this.z!==void 0&&(r.z=this.z,e.z!==void 0&&(r.z+=e.z)),r}subtract(e){let r=new a(this.x-e.x,this.y-e.y);return this.z!==void 0&&(r.z=this.z,e.z!==void 0&&(r.z-=e.z)),r}scale(e=1){if(e===0)return new a(0,0,this.z===void 0?void 0:0);let r=new a(this.x*e,this.y*e);return this.z!==void 0&&(r.z=this.z*e),r}};function K(a){if(a.length!==a[0].length){console.warn("Cannot invert non-square matrices");return}var e=0,r=0,x=0,t=a.length,i=0,l=0,$=[],n=[];for(e=0;e<t;e+=1)for($[$.length]=[],n[n.length]=[],x=0;x<t;x+=1)e==x?$[e][x]=1:$[e][x]=0,n[e][x]=a[e][x];for(e=0;e<t;e+=1){if(i=n[e][e],i==0){for(r=e+1;r<t;r+=1)if(n[r][e]!=0){for(x=0;x<t;x++)i=n[e][x],n[e][x]=n[r][x],n[r][x]=i,i=$[e][x],$[e][x]=$[r][x],$[r][x]=i;break}if(i=n[e][e],i==0)return}for(x=0;x<t;x++)n[e][x]=n[e][x]/i,$[e][x]=$[e][x]/i;for(r=0;r<t;r++)if(r!=e)for(i=n[r][e],x=0;x<t;x++)n[r][x]-=i*n[e][x],$[r][x]-=i*$[e][x]}return $}o(K,"invert");function Y(a,e){var r=[],x=v(e);return a.forEach((t,i)=>{r[i]=[],x.forEach((l,$)=>{r[i][$]=t.map((n,f)=>l[f]*n).reduce((n,f)=>n+f,0)})}),r}o(Y,"multiply");function v(a){return a[0].map((e,r)=>a.map(x=>x[r]))}o(v,"transpose");var R=class a{static{o(this,"Matrix")}constructor(e,r,x){x=e instanceof Array?e:x,this.data=x??[...new Array(e)].map(t=>[...new Array(r)].map(i=>0)),this.rows=this.data.length,this.cols=this.data[0].length}setData(e){this.data=e}get(e,r){return this.data[e][r]}set(e,r,x){this.data[e][r]=x}row(e){return this.data[e]}col(e){var r=this.data,x=[];for(let t=0,i=r.length;t<i;t++)x.push(r[t][e]);return x}multiply(e){return new a(Y(this.data,e.data))}invert(){return new a(K(this.data))}transpose(){return new a(v(this.data))}};function M(a){let e=new TextEncoder().encode(a),r=String.fromCodePoint(...e);return btoa(r)}o(M,"base64");function C(a){let e=atob(a),r=Uint8Array.from(e,x=>x.codePointAt(0));return new TextDecoder().decode(r)}o(C,"decode64");function H(a){let e=/^(.*)\/([^.]+(\.([^\/?#]+))+)(\?[^#]*)?(#.*)?$/,r=a.match(e);if(r!==null){let{[1]:x,[2]:t,[4]:i}=r;a=x}return a}o(H,"getURLbase");function k(a){if(typeof window>"u"||typeof document>"u")return!0;var e=a.getBoundingClientRect();return e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)}o(k,"isInViewport");var P=String(import.meta.url),_=C("Y29uc3QgQUxQSEFCRVRJQyA9IGBhbHBoYWJldGljYDsKY29uc3QgQVVUTyA9IGBhdXRvYDsKY29uc3QgQk9UVE9NID0gYGJvdHRvbWA7CmNvbnN0IEJPVFRPTV9MRUZUID0gYGJvdHRvbi1sZWZ0YDsKY29uc3QgQk9UVE9NX1JJR0hUID0gYGJvdHRvbS1yaWdodGA7CmNvbnN0IENFTlRFUiA9IGBjZW50ZXJgOwpjb25zdCBDT05TVFJBSU4gPSB0cnVlOwpjb25zdCBDUk9TUyA9IGBjcm9zc2hhaXJgOwpjb25zdCBFTkQgPSBgZW5kYDsKY29uc3QgSEFORCA9IGBwb2ludGVyYDsKY29uc3QgSEFOR0lORyA9IGBoYW5naW5nYDsKY29uc3QgSURFT0dSQVBISUMgPSBgaWRlb2dyYXBoaWNgOwpjb25zdCBMRUZUID0gYGxlZnRgOwpjb25zdCBMVFIgPSBgbHRyYDsKY29uc3QgTUlERExFID0gYG1pZGRsZWA7CmNvbnN0IFBPSU5URVIgPSBgZGVmYXVsdGA7CmNvbnN0IFJJR0hUID0gYHJpZ2h0YDsKY29uc3QgUlRMID0gYHJ0bGA7CmNvbnN0IFNUQVJUID0gYHN0YXJ0YDsKY29uc3QgVE9QID0gYHRvcGA7CmNvbnN0IFRPUF9MRUZUID0gYHRvcC1sZWZ0YDsKY29uc3QgVE9QX1JJR0hUID0gYHRvcC1yaWdodGA7Cgpjb25zdCBwb2ludGVyID0geyB4OiAwLCB5OiAwIH07CmNvbnN0IGtleWJvYXJkID0ge307CgovLyBtYXRoIGZ1bmN0aW9ucyBhbmQgY29uc3RhbnRzCmNvbnN0IHsKICBhYnMsCiAgYWNvcywKICBhY29zaCwKICBhc2luLAogIGFzaW5oLAogIGF0YW4sCiAgYXRhbjIsCiAgYXRhbmgsCiAgY2JydCwKICBjZWlsLAogIGNsejMyLAogIGNvcywKICBjb3NoLAogIGV4cCwKICBleHBtMSwKICBmbG9vciwKICBmcm91bmQsCiAgaHlwb3QsCiAgaW11bCwKICBsb2c6IGxuLAogIGxvZzEwOiBsb2csCiAgbG9nMiwKICBtYXgsCiAgbWluLAogIHBvdywKICByb3VuZCwKICBzaWduLAogIHNpbiwKICBzaW5oLAogIHNxcnQsCiAgdGFuLAogIHRhbmgsCiAgdHJ1bmMsCn0gPSBNYXRoOwpjb25zdCB7IFBJLCBFIH0gPSBNYXRoOwpjb25zdCBjb25zdHJhaW4gPSAodiwgcywgZSkgPT4gKHYgPCBzID8gcyA6IHYgPiBlID8gZSA6IHYpOwpjb25zdCBjc2MgPSAodikgPT4gMSAvIHNpbih2KTsKY29uc3QgY3RuID0gKHYpID0+IGNvcyh2KSAvIHNpbih2KTsKY29uc3QgZGlzdCA9ICh4MSwgeTEsIHgyLCB5MikgPT4gKCh4MiAtIHgxKSAqKiAyICsgKHkyIC0geTEpICoqIDIpICoqIDAuNTsKY29uc3QgZXBzaWxvbiA9IE51bWJlci5NSU5fVkFMVUU7CmNvbnN0IGh1Z2UgPSAxXzAwMF8wMDBfMDAwOwpjb25zdCBtYXAgPSAodiwgcywgZSwgbnMsIG5lLCBjb25zdHJhaW5lZCA9IGZhbHNlKSA9PiB7CiAgY29uc3QgaTEgPSBlIC0gcywKICAgIGkyID0gbmUgLSBucywKICAgIHAgPSB2IC0gczsKICBsZXQgciA9IG5zICsgKHAgKiBpMikgLyBpMTsKICBpZiAoY29uc3RyYWluZWQpIHJldHVybiBjb25zdHJhaW4ociwgbnMsIG5lKTsKICByZXR1cm4gcjsKfTsKY29uc3QgcmFuZG9tID0gKGEgPSAxLCBiKSA9PiB7CiAgaWYgKGIgPT09IHVuZGVmaW5lZCkgcmV0dXJuIGEgKiBNYXRoLnJhbmRvbSgpOwogIHJldHVybiBhICsgTWF0aC5yYW5kb20oKSAqIChiIC0gYSk7Cn07CmNvbnN0IHNlYyA9ICh2KSA9PiAxIC8gY29zKHYpOwpjb25zdCBUQVUgPSBQSSAqIDI7CgovLyAicHVibGljIiB2YXJzCgpsZXQgY3VycmVudFBvaW50OwpsZXQgZnJhbWU7CmxldCBoZWlnaHQ7CmxldCB3aWR0aDsKbGV0IHBsYXlpbmc7CgovLyAiaW50ZXJuYWwiIHZhcnMKCmxldCBfX2NhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoYGNhbnZhc2ApOwpfX2NhbnZhcy50YWJJbmRleCA9IDA7Cl9fY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoYHBvaW50ZXJkb3duYCwgKCkgPT4gX19jYW52YXMuZm9jdXMoKSk7CgpsZXQgX19jdHg7CmxldCBfX2N1cnJlbnRfY3Vyc29yOwpsZXQgX19jdXJyZW50X2hpZ2hsaWdodF9jb2xvcjsKbGV0IF9fY3VycmVudF9odWU7CmxldCBfX2RyYXdfZ3JpZDsKbGV0IF9fZHJhd2luZzsKbGV0IF9fZWxlbWVudDsKbGV0IF9fZmluaXNoZWRfc2V0dXA7CmxldCBfX2ZpcnN0OwpsZXQgX19mb250OwpsZXQgX19ncmlkX2NvbG9yOwpsZXQgX19ncmlkX3NwYWNpbmc7CmxldCBfX2hpZ2hsaWdodF9jb2xvcjsKbGV0IF9fbW92YWJsZV9wb2ludHM7CmxldCBfX3JlZHJhd2luZzsKbGV0IF9fc3RhcnRfdGltZTsKbGV0IF9fc3R5bGVfc3RhY2s7CmxldCBfX3RleHRTdHJva2U7Cgpjb25zdCBmaW5kID0gKHFzKSA9PiB7CiAgcmV0dXJuIF9fZWxlbWVudC5xdWVyeVNlbGVjdG9yKHFzKTsKfTsKCmNvbnN0IGZpbmRBbGwgPSAocXMpID0+IHsKICByZXR1cm4gX19lbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwocXMpOwp9OwoKY29uc3Qgc2V0U2l6ZSA9ICh3ID0gNDAwLCBoID0gMjAwKSA9PiB7CiAgd2lkdGggPSBfX2NhbnZhcy53aWR0aCA9IHc7CiAgaGVpZ2h0ID0gX19jYW52YXMuaGVpZ2h0ID0gaDsKICBfX2VsZW1lbnQuc3R5bGUubWF4V2lkdGggPSBgY2FsYygyZW0gKyAke3dpZHRofXB4YDsKICBfX2N0eCA9IF9fY2FudmFzLmdldENvbnRleHQoYDJkYCk7CiAgX19kcmF3KCk7Cn07Cgpjb25zdCByZXNldCA9IGFzeW5jIChlbGVtZW50ID0gX19lbGVtZW50KSA9PiB7CiAgX19lbGVtZW50ID0gZWxlbWVudDsKCiAgLy8gZGVmYXVsdCB2YXJpYWJsZSB2YWx1ZXMKICBfX2N1cnJlbnRfY3Vyc29yID0gYGF1dG9gOwogIF9fY3VycmVudF9oaWdobGlnaHRfY29sb3IgPSBgcmdiKDAsMjU0LDEyNClgOwogIF9fY3VycmVudF9odWUgPSAwOwogIF9fZHJhd19ncmlkID0gdHJ1ZTsKICBfX2RyYXdpbmcgPSBmYWxzZTsKICBfX2ZpbmlzaGVkX3NldHVwID0gZmFsc2U7CiAgX19mb250ID0geyBmYW1pbHk6IGBzYW5zLXNlcmlmYCwgc2l6ZTogMTYsIHdlaWdodDogNDAwIH07CiAgX19ncmlkX2NvbG9yID0gYGxpZ2h0Z3JleWA7CiAgX19ncmlkX3NwYWNpbmcgPSAyMDsKICBfX2hpZ2hsaWdodF9jb2xvciA9IGZhbHNlOwogIF9fbW92YWJsZV9wb2ludHMgPSBbXTsKICBfX3JlZHJhd2luZyA9IGZhbHNlOwogIF9fc3RhcnRfdGltZSA9IERhdGUubm93KCk7CiAgX19zdHlsZV9zdGFjayA9IFtdOwogIF9fdGV4dFN0cm9rZSA9IGB0cmFuc3BhcmVudGA7CgogIGN1cnJlbnRQb2ludCA9IGZhbHNlOwogIHBsYXlpbmcgPSBmYWxzZTsKICBmcmFtZSA9IDA7CiAgcG9pbnRlci54ID0gMDsKICBwb2ludGVyLnkgPSAwOwogIE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKGtleWJvYXJkKS5mb3JFYWNoKChuKSA9PiBkZWxldGUga2V5Ym9hcmRbbl0pOwoKICAvLyBtYWtlIHN1cmUgd2UgZG9uJ3QgZG91YmxlLWdlbmVyYXRlIHRoZXNlOgogIGNsZWFyU2xpZGVycygpOwogIGNsZWFyQnV0dG9ucygpOwoKICAvLyBydW4gc2V0dXAKICBhd2FpdCBfX3NldHVwKCk7CiAgX19maW5pc2hlZF9zZXR1cCA9IHRydWU7CgogIC8vIHJ1biBmaXJzdCBkcmF3CiAgYXdhaXQgX19kcmF3KCk7Cn07Cgpjb25zdCBoYWx0ID0gKCkgPT4gewogIGNvbnN0IHN0eWxlID0gZ2V0Q29tcHV0ZWRTdHlsZShfX2VsZW1lbnQpOwogIHdpZHRoID0gc3R5bGUud2lkdGg7CiAgaGVpZ2h0ID0gc3R5bGUuaGVpZ2h0OwogIHBsYXlpbmcgPSBmYWxzZTsKICBfX2NhbnZhcyA9IHVuZGVmaW5lZDsKICBfX2N0eCA9IHVuZGVmaW5lZDsKICBfX2ZpbmlzaGVkX3NldHVwID0gZmFsc2U7CiAgX19kcmF3aW5nID0gdHJ1ZTsKICBfX3JlZHJhd2luZyA9IHRydWU7CiAgX19maXJzdCA9IHVuZGVmaW5lZDsKICBfX21vdmFibGVfcG9pbnRzID0gdW5kZWZpbmVkOwogIF9fY3VycmVudF9jdXJzb3IgPSB1bmRlZmluZWQ7CiAgX19jdXJyZW50X2h1ZSA9IDA7CiAgX19mb250ID0gdW5kZWZpbmVkOwogIF9fc3RhcnRfdGltZSA9IDA7CiAgY2xlYXJTbGlkZXJzKCk7CiAgY2xlYXJCdXR0b25zKCk7CiAgcmV0dXJuIHsgd2lkdGgsIGhlaWdodCB9Owp9OwoKY29uc3QgX19zZXR1cCA9IGFzeW5jICgpID0+IHsKICBpZiAodHlwZW9mIHNldHVwICE9PSBgdW5kZWZpbmVkYCkgYXdhaXQgc2V0dXAoKTsKICBpZiAodHlwZW9mIF9fbW9yZV9zZXR1cCAhPT0gYHVuZGVmaW5lZGApIGF3YWl0IF9fbW9yZV9zZXR1cCgpOwp9OwoKY29uc3QgX19kcmF3ID0gYXN5bmMgKCkgPT4gewogIGlmICghX19maW5pc2hlZF9zZXR1cCkgcmV0dXJuOwogIGlmICghX19kcmF3aW5nKSB7CiAgICBfX2RyYXdpbmcgPSB0cnVlOwogICAgZnJhbWUrKzsKICAgIHJlc2V0VHJhbnNmb3JtKCk7CiAgICBpZiAodHlwZW9mIGRyYXcgIT09IGB1bmRlZmluZWRgKSBhd2FpdCBkcmF3KCk7CiAgICBpZiAodHlwZW9mIF9fbW9yZV9kcmF3ICE9PSBgdW5kZWZpbmVkYCkgYXdhaXQgX19tb3JlX2RyYXcoKTsKICAgIF9fZHJhd2luZyA9IGZhbHNlOwogICAgaWYgKHBsYXlpbmcpIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiBfX2RyYXcoKSk7CiAgfQp9OwoKY29uc3QgcmVkcmF3ID0gKCkgPT4gewogIGlmIChfX3JlZHJhd2luZykgcmV0dXJuOwogIGlmIChwbGF5aW5nKSByZXR1cm47CiAgX19yZWRyYXdpbmcgPSB0cnVlOwogIF9fZHJhdygpOwogIF9fcmVkcmF3aW5nID0gZmFsc2U7Cn07CgovLyAtLS0tLS0tLS0tLS0tLS0tLS0gcG9pbnRlciBoZWxwZXIgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKY29uc3QgX19jaGVja0ZvckN1cnJlbnRQb2ludCA9ICh4LCB5LCB0eXBlKSA9PiB7CiAgY29uc3QgbWF0Y2hlcyA9IFtdOwogIGNvbnN0IG1hdGNoUGFkZGluZyA9IHR5cGUgPT09IGBtb3VzZWAgPyAxMCA6IDMwOwogIF9fbW92YWJsZV9wb2ludHMuZm9yRWFjaCgocCkgPT4gewogICAgbGV0IHgyID0gcFswXSA9PT0gdW5kZWZpbmVkID8gcC54IDogcFswXTsKICAgIGxldCB5MiA9IHBbMV0gPT09IHVuZGVmaW5lZCA/IHAueSA6IHBbMV07CiAgICBjb25zdCBkID0gZGlzdCh4LCB5LCB4MiwgeTIpOwogICAgaWYgKGQgPCAocC5yID8gcC5yIDogMCkgKyBtYXRjaFBhZGRpbmcpIHsKICAgICAgbWF0Y2hlcy5wdXNoKHsgcCwgZCB9KTsKICAgIH0KICB9KTsKICBjdXJyZW50UG9pbnQgPSBmYWxzZTsKICBfX2NhbnZhcy5zdHlsZS5jdXJzb3IgPSBgYXV0b2A7CiAgaWYgKG1hdGNoZXMubGVuZ3RoKSB7CiAgICBtYXRjaGVzLnNvcnQoKGEsIGIpID0+IGEuZCAtIGIuZCk7CiAgICBjdXJyZW50UG9pbnQgPSBtYXRjaGVzWzBdLnA7CiAgICBfX2NhbnZhcy5zdHlsZS5jdXJzb3IgPSBgcG9pbnRlcmA7CiAgfQp9OwoKLy8gLS0tLS0tLS0tLS0tLS0tIHBvaW50ZXIgZXZlbnQgaGFuZGxpbmcgLS0tLS0tLS0tLS0tLS0tLS0tLQoKY29uc3QgX19wb2ludGVyRG93biA9ICh4LCB5KSA9PiB7CiAgaWYgKGN1cnJlbnRQb2ludCkgewogICAgY3VycmVudFBvaW50Ll9keCA9IGN1cnJlbnRQb2ludC54IC0geDsKICAgIGN1cnJlbnRQb2ludC5fZHkgPSBjdXJyZW50UG9pbnQueSAtIHk7CiAgfQogIGlmICh0eXBlb2YgcG9pbnRlckRvd24gIT09IGB1bmRlZmluZWRgKSBwb2ludGVyRG93bih4LCB5KTsKfTsKCl9fY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoCiAgYHBvaW50ZXJkb3duYCwKICAoeyBvZmZzZXRYLCBvZmZzZXRZLCBwb2ludGVyVHlwZTogdHlwZSB9KSA9PiB7CiAgICBpZiAoX19maW5pc2hlZF9zZXR1cCkgewogICAgICBjb25zdCB7IHgsIHkgfSA9IHNjcmVlblRvV29ybGQob2Zmc2V0WCwgb2Zmc2V0WSk7CiAgICAgIE9iamVjdC5hc3NpZ24ocG9pbnRlciwgeyB4LCB5LCB0eXBlLCBkb3duOiB0cnVlLCBtYXJrOiB7IHgsIHkgfSB9KTsKICAgICAgaWYgKHR5cGUgIT09IGBtb3VzZWApIHsKICAgICAgICBfX2NoZWNrRm9yQ3VycmVudFBvaW50KHgsIHksIHR5cGUpOwogICAgICB9CiAgICAgIF9fcG9pbnRlckRvd24oeCwgeSk7CiAgICB9CiAgfQopOwoKY29uc3QgX19wb2ludGVyVXAgPSAoeCwgeSkgPT4gewogIGlmICh0eXBlb2YgcG9pbnRlclVwICE9PSBgdW5kZWZpbmVkYCkgcG9pbnRlclVwKHgsIHkpOwogIGlmIChwb2ludGVyLm1hcms/LnggPT09IHggJiYgcG9pbnRlci5tYXJrPy55ID09PSB5KSB7CiAgICBpZiAodHlwZW9mIHBvaW50ZXJDbGljayAhPT0gYHVuZGVmaW5lZGApIHBvaW50ZXJDbGljayh4LCB5KTsKICB9Cn07CgpfX2NhbnZhcy5hZGRFdmVudExpc3RlbmVyKAogIGBwb2ludGVydXBgLAogICh7IG9mZnNldFgsIG9mZnNldFksIHBvaW50ZXJUeXBlOiB0eXBlIH0pID0+IHsKICAgIGlmIChfX2ZpbmlzaGVkX3NldHVwKSB7CiAgICAgIGNvbnN0IHsgeCwgeSB9ID0gc2NyZWVuVG9Xb3JsZChvZmZzZXRYLCBvZmZzZXRZKTsKICAgICAgT2JqZWN0LmFzc2lnbihwb2ludGVyLCB7IHgsIHksIHR5cGUsIGRvd246IGZhbHNlLCBtYXJrOiBmYWxzZSB9KTsKICAgICAgX19wb2ludGVyVXAoeCwgeSk7CiAgICB9CiAgfQopOwoKY29uc3QgX19wb2ludGVyTW92ZSA9ICh4LCB5KSA9PiB7CiAgbGV0IHBvaW50TW92ZWQgPSBmYWxzZTsKICBpZiAocG9pbnRlci5kb3duICYmIGN1cnJlbnRQb2ludCkgewogICAgaWYgKGN1cnJlbnRQb2ludFswXSkgewogICAgICBjdXJyZW50UG9pbnRbMF0gPSB4ICsgY3VycmVudFBvaW50Ll9keDsKICAgICAgY3VycmVudFBvaW50WzFdID0geSArIGN1cnJlbnRQb2ludC5fZHk7CiAgICB9IGVsc2UgewogICAgICBjdXJyZW50UG9pbnQueCA9IHggKyBjdXJyZW50UG9pbnQuX2R4OwogICAgICBjdXJyZW50UG9pbnQueSA9IHkgKyBjdXJyZW50UG9pbnQuX2R5OwogICAgfQogICAgcG9pbnRNb3ZlZCA9IHRydWU7CiAgfQoKICBpZiAodHlwZW9mIHBvaW50ZXJNb3ZlICE9PSBgdW5kZWZpbmVkYCkgewogICAgcG9pbnRlck1vdmUoeCwgeSk7CiAgICBwb2ludGVyLmRyYWcgPSBmYWxzZTsKICAgIGlmIChwb2ludGVyLmRvd24gJiYgdHlwZW9mIHBvaW50ZXJEcmFnICE9PSBgdW5kZWZpbmVkYCkgewogICAgICBwb2ludGVyLmRyYWcgPSB0cnVlOwogICAgICBwb2ludGVyRHJhZyh4LCB5KTsKICAgIH0KICB9CiAgaWYgKHBvaW50TW92ZWQgJiYgIXBsYXlpbmcpIHJlZHJhdygpOwp9OwoKX19jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcigKICBgcG9pbnRlcm1vdmVgLAogICh7IG9mZnNldFgsIG9mZnNldFksIHBvaW50ZXJUeXBlOiB0eXBlIH0pID0+IHsKICAgIGlmIChfX2ZpbmlzaGVkX3NldHVwKSB7CiAgICAgIGNvbnN0IHsgeCwgeSB9ID0gc2NyZWVuVG9Xb3JsZChvZmZzZXRYLCBvZmZzZXRZKTsKICAgICAgT2JqZWN0LmFzc2lnbihwb2ludGVyLCB7IHgsIHksIHR5cGUgfSk7CiAgICAgIGlmICghcG9pbnRlci5kb3duKSBfX2NoZWNrRm9yQ3VycmVudFBvaW50KHgsIHksIHR5cGUpOwogICAgICBfX3BvaW50ZXJNb3ZlKHgsIHkpOwogICAgfQogIH0KKTsKCi8vIC0tLS0tLS0tLS0tLS0tLS0tLSBrZXkgZXZlbnQgaGFuZGxpbmcgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKY29uc3QgX19zYWZlbHlJbnRlcmNlcHRLZXkgPSAoZXZ0KSA9PiB7CiAgLy8gV2UgZG9uJ3Qgd2FudCB0byBpbnRlcmZlcmUgd2l0aCB0aGUgYnJvd3Nlciwgc28gd2UncmUgb25seQogIC8vIGdvaW5nIHRvIGFsbG93IHVubW9kaWZpZWQga2V5cywgb3Igc2hpZnQtbW9kaWZpZWQga2V5cywKICAvLyBhbmQgdGFiIGhhcyB0byBhbHdheXMgd29yay4gRm9yIG9idmlvdXMgcmVhc29ucy4KICBjb25zdCB0YWIgPSBldnQua2V5ICE9PSAiVGFiIjsKICBjb25zdCBmdW5jdGlvbktleSA9IGV2dC5rZXkubWF0Y2goL0ZcZCsvKSA9PT0gbnVsbDsKICBjb25zdCBzcGVjaWZpY0NoZWNrID0gdGFiICYmIGZ1bmN0aW9uS2V5OwogIGlmICghZXZ0LmFsdEtleSAmJiAhZXZ0LmN0cmxLZXkgJiYgIWV2dC5tZXRhS2V5ICYmIHNwZWNpZmljQ2hlY2spIHsKICAgIGlmIChldnQudGFyZ2V0ID09PSBfX2NhbnZhcykgewogICAgICBldnQucHJldmVudERlZmF1bHQoKTsKICAgICAgZXZ0LnN0b3BQcm9wYWdhdGlvbigpOwogICAgfQogIH0KfTsKCmNvbnN0IF9fa2V5RG93biA9IChrZXksIHNoaWZ0S2V5LCBhbHRLZXksIGN0cmxLZXksIG1ldGFLZXkpID0+IHsKICBrZXlib2FyZFtrZXldID0gRGF0ZS5ub3coKTsKICBpZiAodHlwZW9mIGtleURvd24gIT09IGB1bmRlZmluZWRgKQogICAga2V5RG93bihrZXksIHNoaWZ0S2V5LCBhbHRLZXksIGN0cmxLZXksIG1ldGFLZXkpOwp9OwoKX19jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcihga2V5ZG93bmAsIChldnQpID0+IHsKICBfX3NhZmVseUludGVyY2VwdEtleShldnQpOwogIGNvbnN0IHsga2V5LCBzaGlmdEtleSwgYWx0S2V5LCBjdHJsS2V5LCBtZXRhS2V5IH0gPSBldnQ7CiAgaWYgKF9fZmluaXNoZWRfc2V0dXApIF9fa2V5RG93bihrZXksIHNoaWZ0S2V5LCBhbHRLZXksIGN0cmxLZXksIG1ldGFLZXkpOwp9KTsKCmNvbnN0IF9fa2V5VXAgPSAoa2V5LCBzaGlmdEtleSwgYWx0S2V5LCBjdHJsS2V5LCBtZXRhS2V5KSA9PiB7CiAgZGVsZXRlIGtleWJvYXJkW2tleV07CiAgaWYgKHR5cGVvZiBrZXlVcCAhPT0gYHVuZGVmaW5lZGApCiAgICBrZXlVcChrZXksIHNoaWZ0S2V5LCBhbHRLZXksIGN0cmxLZXksIG1ldGFLZXkpOwp9OwoKX19jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcihga2V5dXBgLCAoZXZ0KSA9PiB7CiAgX19zYWZlbHlJbnRlcmNlcHRLZXkoZXZ0KTsKICBjb25zdCB7IGtleSwgc2hpZnRLZXksIGFsdEtleSwgY3RybEtleSwgbWV0YUtleSB9ID0gZXZ0OwogIGlmIChfX2ZpbmlzaGVkX3NldHVwKSBfX2tleVVwKGtleSwgc2hpZnRLZXksIGFsdEtleSwgY3RybEtleSwgbWV0YUtleSk7Cn0pOwoKLy8gLS0tLS0tLS0tLS0tLS0tLSBzbGlkZXIgZnVuY3Rpb25zIC0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKY29uc3QgYWRkU2xpZGVyID0gKHByb3BMYWJlbCwgYXNzaWduLCBvcHRpb25zID0ge30pID0+IHsKICBjb25zdCB7CiAgICBtaW4gPSAwLAogICAgbWF4ID0gMSwKICAgIHN0ZXAgPSAxLAogICAgdmFsdWUgPSAwLAogICAgY2xhc3NlcyA9IGBzbGlkZXJgLAogICAgdHJhbnNmb3JtID0gKHYpID0+IHYsCiAgfSA9IG9wdGlvbnM7CgogIGNvbnN0IGNyZWF0ZSA9ICh0YWcpID0+IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTsKCiAgbGV0IHNsaWRlciA9IGNyZWF0ZShgaW5wdXRgKTsKICBzbGlkZXIudHlwZSA9IGByYW5nZWA7CiAgc2xpZGVyLm1pbiA9IG1pbjsKICBzbGlkZXIubWF4ID0gbWF4OwogIHNsaWRlci5zdGVwID0gc3RlcDsKICBzbGlkZXIuc2V0QXR0cmlidXRlKGB2YWx1ZWAsIHZhbHVlKTsKICBzbGlkZXIuc2V0QXR0cmlidXRlKGBjbGFzc2AsIGNsYXNzZXMpOwoKICBjb25zdCB1cGRhdGUgPSAoeyB2YWx1ZSB9KSA9PiB7CiAgICB2YWx1ZUZpZWxkLnRleHRDb250ZW50ID0gdmFsdWU7CiAgICBhc3NpZ24odHJhbnNmb3JtKHBhcnNlRmxvYXQodmFsdWUpKSk7CiAgICBpZiAoIXBsYXlpbmcpIHJlZHJhdygpOwogIH07CgogIHNsaWRlci5hZGRFdmVudExpc3RlbmVyKGBpbnB1dGAsICh7IHRhcmdldCB9KSA9PiB1cGRhdGUodGFyZ2V0KSk7CgogIGxldCB0YWJsZSA9IF9fZWxlbWVudC5xdWVyeVNlbGVjdG9yKGB0YWJsZS5zbGlkZXItd3JhcHBlcmApOwogIGlmICghdGFibGUpIHsKICAgIHRhYmxlID0gY3JlYXRlKGB0YWJsZWApOwogICAgdGFibGUuY2xhc3NMaXN0LmFkZChgc2xpZGVyLXdyYXBwZXJgKTsKICAgIF9fZWxlbWVudC5wcmVwZW5kKHRhYmxlKTsKICB9CiAgbGV0IHRyID0gY3JlYXRlKGB0cmApOwoKICBsZXQgdGQgPSBjcmVhdGUoYHRkYCk7CiAgbGV0IGxhYmVsID0gY3JlYXRlKGBsYWJlbGApOwogIGxhYmVsLmNsYXNzTGlzdC5hZGQoYHNsaWRlci1sYWJlbGApOwogIGxhYmVsLmlubmVySFRNTCA9IHByb3BMYWJlbAogICAgLnJlcGxhY2UoL18oLispJC8sIGA8c3ViPiQxPC9zdWI+YCkKICAgIC5yZXBsYWNlKC8oXGQrKS8sIGA8c3ViPiQxPC9zdWI+YCk7CiAgdGQuYXBwZW5kKGxhYmVsKTsKICB0ci5hcHBlbmQodGQpOwoKICB0ZCA9IGNyZWF0ZShgdGRgKTsKICB0ZC5jbGFzc0xpc3QuYWRkKGBzbGlkZXItbWluYCk7CiAgdGQudGV4dENvbnRlbnQgPSBzbGlkZXIubWluOwogIHRyLmFwcGVuZCh0ZCk7CgogIHRkID0gY3JlYXRlKGB0ZGApOwogIHRkLndpZHRoID0gYCpgOwogIHRkLmFwcGVuZChzbGlkZXIpOwogIHRyLmFwcGVuZCh0ZCk7CgogIHRkID0gY3JlYXRlKGB0ZGApOwogIHRkLmNsYXNzTGlzdC5hZGQoYHNsaWRlci1tYXhgKTsKICB0ZC50ZXh0Q29udGVudCA9IHNsaWRlci5tYXg7CiAgdHIuYXBwZW5kKHRkKTsKCiAgdGQgPSBjcmVhdGUoYHRkYCk7CiAgdmFyIHZhbHVlRmllbGQgPSBjcmVhdGUoYGxhYmVsYCk7IC8vIGZ1bmN0aW9uIHNjb3BlZAogIHZhbHVlRmllbGQuY2xhc3NMaXN0LmFkZChgc2xpZGVyLXZhbHVlYCk7CiAgdGQuYXBwZW5kKHZhbHVlRmllbGQpOwogIHRyLmFwcGVuZCh0ZCk7CiAgdGQuYWRkRXZlbnRMaXN0ZW5lcihgcG9pbnRlcmRvd25gLCAoKSA9PiB7CiAgICBjb25zdCB2YWx1ZSA9IHByb21wdChgbmV3IHZhbHVlP2AsIHNsaWRlci52YWx1ZSk7CiAgICBpZiAodmFsdWUgIT09IG51bGwpIHsKICAgICAgc2xpZGVyLnZhbHVlID0gdmFsdWU7CiAgICAgIHVwZGF0ZSh7IHZhbHVlIH0pOwogICAgfQogIH0pOwoKICB0YWJsZS5hcHBlbmQodHIpOwoKICB1cGRhdGUoc2xpZGVyKTsKfTsKCmNvbnN0IGNsZWFyU2xpZGVycyA9ICgpID0+IHsKICBjb25zdCB0YWJsZSA9IF9fZWxlbWVudC5xdWVyeVNlbGVjdG9yKGB0YWJsZS5zbGlkZXItd3JhcHBlcmApOwogIGlmICh0YWJsZSkgdGFibGUuaW5uZXJIVE1MID0gYGA7Cn07Cgpjb25zdCBhZGRCdXR0b24gPSAobGFiZWwsIG9uQ2xpY2spID0+IHsKICBjb25zdCBidG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGBidXR0b25gKTsKICBidG4uY2xhc3NMaXN0LmFkZChgZ3JhcGhpY3MtZWxlbWVudC1idXR0b25gKTsKICBidG4udGV4dENvbnRlbnQgPSBsYWJlbDsKICBidG4uYWRkRXZlbnRMaXN0ZW5lcihgY2xpY2tgLCAoKSA9PiBvbkNsaWNrKGJ0bikpOwogIF9fZWxlbWVudC5wcmVwZW5kKGJ0bik7Cn07Cgpjb25zdCBjbGVhckJ1dHRvbnMgPSAoKSA9PiB7CiAgX19lbGVtZW50CiAgICAucXVlcnlTZWxlY3RvckFsbChgYnV0dG9uLmdyYXBoaWNzLWVsZW1lbnQtYnV0dG9uYCkKICAgIC5mb3JFYWNoKChlKSA9PiBlLnJlbW92ZSgpKTsKfTsKCi8vIC0tLS0tLS0tLS0gZ2VuZXJhbCBmdW5jdGlvbnMgLS0tLS0tLS0tLS0tLQoKY29uc3QgY2xlYXJNb3ZhYmxlID0gKCkgPT4gewogIF9fbW92YWJsZV9wb2ludHMuc3BsaWNlKDAsIF9fbW92YWJsZV9wb2ludHMubGVuZ3RoKTsKfTsKCmNvbnN0IGNvcHkgPSAoKSA9PiB7CiAgY29uc3QgY29weSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoYGNhbnZhc2ApOwogIGNvcHkud2lkdGggPSB3aWR0aDsKICBjb3B5LmhlaWdodCA9IGhlaWdodDsKICBjb25zdCBjdHggPSBjb3B5LmdldENvbnRleHQoYDJkYCk7CiAgY3R4LmRyYXdJbWFnZShfX2NhbnZhcywgMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgcmV0dXJuIGNvcHk7Cn07Cgpjb25zdCBjb2xvciA9IChoID0gX19jdXJyZW50X2h1ZSwgcyA9IDUwLCBsID0gNTAsIGEgPSAxKSA9PiB7CiAgcmV0dXJuIGBoc2xhKCR7aH0sJHtzfSUsJHtsfSUsJHthfSlgOwp9OwoKY29uc3QgaGlnaGxpZ2h0ID0gKGNvbG9yKSA9PiB7CiAgX19oaWdobGlnaHRfY29sb3IgPSBjb2xvcjsKICByZWRyYXcoKTsKfTsKCmNvbnN0IG1pbGxpcyA9ICgpID0+IHsKICByZXR1cm4gRGF0ZS5ub3coKSAtIF9fc3RhcnRfdGltZTsKfTsKCmNvbnN0IHBhdXNlID0gKCkgPT4gewogIHBsYXlpbmcgPSBmYWxzZTsKfTsKCmNvbnN0IHBsYXkgPSAoKSA9PiB7CiAgcGxheWluZyA9IHRydWU7CiAgX19kcmF3KCk7Cn07Cgpjb25zdCByYW5kb21Db2xvciA9IChhID0gMS4wLCBjeWNsZSA9IHRydWUpID0+IHsKICBpZiAoY3ljbGUpIF9fY3VycmVudF9odWUgPSAoX19jdXJyZW50X2h1ZSArIDczKSAlIDM2MDsKICByZXR1cm4gYGhzbGEoJHtfX2N1cnJlbnRfaHVlfSw1MCUsNTAlLCR7YX0pYDsKfTsKCmNvbnN0IHNldE1vdmFibGUgPSAocG9pbnRzKSA9PiB7CiAgLy8gVE9ETzogc2hhcGVzCiAgaWYgKCFwb2ludHMuZm9yRWFjaCkgewogICAgcG9pbnRzID0gW3BvaW50c107CiAgfQogIHBvaW50cy5mb3JFYWNoKChwKSA9PiB7CiAgICBpZiAoX19tb3ZhYmxlX3BvaW50cy5pbmRleE9mKHApID09PSAtMSkgewogICAgICBfX21vdmFibGVfcG9pbnRzLnB1c2gocCk7CiAgICB9CiAgfSk7Cn07Cgpjb25zdCByZXN0b3JlID0gKCkgPT4gewogIF9fY3R4LnJlc3RvcmUoKTsKfTsKCi8qKgogKiBTYXZlIHRoZSBjYW52YXMgY29udGV4dC4KICovCmNvbnN0IHNhdmUgPSAoKSA9PiB7CiAgX19jdHguc2F2ZSgpOwp9OwoKY29uc3QgdG9EYXRhVVJMID0gKCkgPT4gewogIHJldHVybiBfX2NhbnZhcy50b0RhdGFVUkwoKTsKfTsKCmNvbnN0IHRvZ2dsZVBsYXkgPSAoKSA9PiB7CiAgcGxheWluZyA/IHBhdXNlKCkgOiBwbGF5KCk7CiAgcmV0dXJuIHBsYXlpbmc7Cn07CgovLyAtLS0tLS0tLS0tIGRyYXcgZnVuY3Rpb25zIC0tLS0tLS0tLS0tLS0KCmNvbnN0IGFyYyA9ICh4LCB5LCByLCBzID0gMCwgZSA9IFRBVSwgd2VkZ2UgPSBmYWxzZSkgPT4gewogIHN0YXJ0KCk7CiAgaWYgKHdlZGdlKSBfX2N0eC5tb3ZlVG8oeCwgeSk7CiAgX19jdHguYXJjKHgsIHksIHIsIHMsIGUpOwogIGlmICh3ZWRnZSkgX19jdHgubGluZVRvKHgsIHkpOwogIGVuZCgpOwp9OwoKY29uc3QgYXhlcyA9ICgKICBoTGFiZWwsCiAgaHMsCiAgaGUsCiAgdkxhYmVsLAogIHZzLAogIHZlLAogIGhzTGFiZWwgPSBmYWxzZSwKICBoZUxhYmVsID0gZmFsc2UsCiAgdnNMYWJlbCA9IGZhbHNlLAogIHZlTGFiZWwgPSBmYWxzZQopID0+IHsKICBsaW5lKGhzLCAwLCBoZSwgMCk7CiAgbGluZSgwLCB2cywgMCwgdmUpOwoKICBjb25zdCBocG9zID0gMCAtIDU7CiAgdGV4dChgJHtoTGFiZWx9IOKGkmAsIHdpZHRoIC8gMiwgaHBvcywgQ0VOVEVSKTsKICB0ZXh0KGhzTGFiZWwgPyBoc0xhYmVsIDogaHMsIGhzLCBocG9zLCBDRU5URVIpOwogIHRleHQoaGVMYWJlbCA/IGhlTGFiZWwgOiBoZSwgaGUsIGhwb3MsIENFTlRFUik7CgogIGNvbnN0IHZwb3MgPSAtNTsKICB0ZXh0KGAke3ZMYWJlbH1gLCB2cG9zLCBoZWlnaHQgLyAyLCBSSUdIVCk7CiAgdGV4dChg4oaTYCwgdnBvcywgaGVpZ2h0IC8gMiArIDE2LCBSSUdIVCk7CiAgdGV4dCh2c0xhYmVsID8gdnNMYWJlbCA6IHZzLCB2cG9zLCB2cyArIDUsIFJJR0hUKTsKICB0ZXh0KHZlTGFiZWwgPyB2ZUxhYmVsIDogdmUsIHZwb3MsIHZlLCBSSUdIVCk7Cn07Cgpjb25zdCBiZXppZXIgPSAocG9pbnRzKSA9PiB7CiAgY29uc3QgW2ZpcnN0LCAuLi5yZXN0XSA9IHBvaW50czsKICBzdGFydCgpOwogIHZlcnRleChmaXJzdC54LCBmaXJzdC55KTsKICBmb3IgKGxldCBpID0gMCwgZSA9IHJlc3QubGVuZ3RoOyBpIDwgZTsgaSArPSAzKSB7CiAgICBsZXQgW3AxLCBwMiwgcDNdID0gcmVzdC5zbGljZShpLCBpICsgMyk7CiAgICBpZiAocDEgJiYgcDIgJiYgcDMpIF9fY3R4LmJlemllckN1cnZlVG8ocDEueCwgcDEueSwgcDIueCwgcDIueSwgcDMueCwgcDMueSk7CiAgfQogIGVuZCgpOwp9OwoKY29uc3QgYnNwbGluZSA9IChwb2ludHMsIG9wZW4gPSB0cnVlKSA9PiB7CiAgc3RhcnQoKTsKICBuZXcgQlNwbGluZShwb2ludHMsIG9wZW4pLmdldExVVCgpLmZvckVhY2goKHApID0+IHZlcnRleChwLngsIHAueSkpOwogIGVuZCgpOwp9OwoKY29uc3QgY2lyY2xlID0gKHgsIHksIHIpID0+IHsKICBhcmMoeCwgeSwgcik7Cn07Cgpjb25zdCBjbGVhciA9IChjb2xvciA9IGB3aGl0ZWApID0+IHsKICBzYXZlKCk7CiAgX19jYW52YXMuc3R5bGUuYmFja2dyb3VuZCA9IGNvbG9yOwogIF9fY2FudmFzLndpZHRoID0gd2lkdGg7CiAgX19jdHggPSBfX2NhbnZhcy5nZXRDb250ZXh0KGAyZGApOwogIGlmIChfX2RyYXdfZ3JpZCkgZ3JpZCgpOwogIHJlc3RvcmUoKTsKfTsKCmNvbnN0IGVuZCA9IChjbG9zZSA9IGZhbHNlKSA9PiB7CiAgaWYgKGNsb3NlKSBfX2N0eC5jbG9zZVBhdGgoKTsKICBfX2N0eC5maWxsKCk7CiAgX19jdHguc3Ryb2tlKCk7CiAgaWYgKF9fY3R4LmxpbmVXaWR0aCAlIDIgPT09IDEpIHsKICAgIF9fY3R4LnRyYW5zbGF0ZSgtMC41LCAtMC41KTsKICB9Cn07Cgpjb25zdCBncmlkID0gKCkgPT4gewogIHNhdmUoKTsKICBzZXRMaW5lV2lkdGgoMC41KTsKICBub0ZpbGwoKTsKICBzZXRTdHJva2UoX19ncmlkX2NvbG9yKTsKICBmb3IgKAogICAgbGV0IHggPSAoLTAuNSArIF9fZ3JpZF9zcGFjaW5nIC8gMikgfCAwOwogICAgeCA8IHdpZHRoOwogICAgeCArPSBfX2dyaWRfc3BhY2luZwogICkgewogICAgbGluZSh4LCAwLCB4LCBoZWlnaHQpOwogIH0KICBmb3IgKAogICAgbGV0IHkgPSAoLTAuNSArIF9fZ3JpZF9zcGFjaW5nIC8gMikgfCAwOwogICAgeSA8IGhlaWdodDsKICAgIHkgKz0gX19ncmlkX3NwYWNpbmcKICApIHsKICAgIGxpbmUoMCwgeSwgd2lkdGgsIHkpOwogIH0KICByZXN0b3JlKCk7Cn07Cgpjb25zdCBpbWFnZSA9IGFzeW5jIChpbWcsIHggPSAwLCB5ID0gMCwgdywgaCkgPT4gewogIGlmICh0eXBlb2YgaW1nID09PSBgc3RyaW5nYCkgewogICAgaW1nID0gYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgICBjb25zdCB0YWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGBpbWdgKTsKICAgICAgdGFnLm9ubG9hZCA9ICgpID0+IHJlc29sdmUodGFnKTsKICAgICAgdGFnLm9uZXJyb3IgPSAoKSA9PiByZWplY3QoKTsKICAgICAgdGFnLnNyYyA9IGltZzsKICAgIH0pOwogIH0KICBfX2N0eC5kcmF3SW1hZ2UoaW1nLCB4LCB5LCB3IHx8IGltZy53aWR0aCwgaCB8fCBpbWcuaGVpZ2h0KTsKfTsKCmNvbnN0IGxpbmUgPSAoeDEsIHkxLCB4MiwgeTIpID0+IHsKICBzdGFydCgpOwogIHZlcnRleCh4MSwgeTEpOwogIHZlcnRleCh4MiwgeTIpOwogIGVuZCgpOwp9OwoKY29uc3QgcGxvdCA9IChmLCBhID0gMCwgYiA9IDEsIHN0ZXBzID0gMjQsIHhzY2FsZSA9IDEsIHlzY2FsZSA9IDEpID0+IHsKICBjb25zdCBpbnRlcnZhbCA9IGIgLSBhOwogIHN0YXJ0KCk7CiAgZm9yIChsZXQgaSA9IDAsIGUgPSBzdGVwcyAtIDEsIHgsIHksIHY7IGkgPCBzdGVwczsgaSsrKSB7CiAgICB4ID0gYSArIGludGVydmFsICogKGkgLyBlKTsKICAgIHkgPSBmKHgpOwogICAgdmVydGV4KHggKiB4c2NhbGUsIHkgKiB5c2NhbGUpOwogIH0KICBlbmQoKTsKfTsKCmNvbnN0IHBsb3REYXRhID0gKGRhdGEsIHgsIHkpID0+IHsKICBzdGFydCgpOwogIGRhdGEuZm9yRWFjaCgocCkgPT4gdmVydGV4KHBbeF0sIHBbeV0pKTsKICBlbmQoKTsKfTsKCmNvbnN0IHBvaW50ID0gKHgsIHkpID0+IHsKICBjaXJjbGUoeCwgeSwgMyk7Cn07Cgpjb25zdCByZWN0ID0gKHgsIHksIHcsIGgpID0+IHsKICBzdGFydCgpOwogIHZlcnRleCh4LCB5KTsKICB2ZXJ0ZXgoeCArIHdpZHRoLCB5KTsKICB2ZXJ0ZXgoeCArIHdpZHRoLCB5ICsgaGVpZ2h0KTsKICB2ZXJ0ZXgoeCwgeSArIGhlaWdodCk7CiAgdmVydGV4KHgsIHkpOwogIGVuZCgpOwp9OwoKLy8gZHJhdyBhIGNhcmRpbmFsIHNwbGluZSB3aXRoIHZpcnR1YWwgc3RhcnQgYW5kIGVuZCBwb2ludApjb25zdCBzcGxpbmUgPSAocG9pbnRzLCB2aXJ0dWFsID0gdHJ1ZSwgdGlnaHRuZXNzID0gMSwgVCA9IHRpZ2h0bmVzcykgPT4gewogIGxldCBjcG9pbnRzID0gcG9pbnRzOwogIGlmICh2aXJ0dWFsKSB7CiAgICBjb25zdCBmMCA9IHBvaW50c1swXSwKICAgICAgZjEgPSBwb2ludHNbMV0sCiAgICAgIGYyID0gcG9pbnRzWzJdLAogICAgICBmc20gPSBuZXcgVmVjdG9yKGYwLnggLyAyICsgZjIueCAvIDIsIGYwLnkgLyAyICsgZjIueSAvIDIpLAogICAgICBmMHIgPSBuZXcgVmVjdG9yKGYwKS5yZWZsZWN0KGYxKSwKICAgICAgZnNyID0gZnNtLnJlZmxlY3QoZjEpLAogICAgICBmbiA9IG5ldyBWZWN0b3IoZjByLnggLyAyICsgZnNyLnggLyAyLCBmMHIueSAvIDIgKyBmc3IueSAvIDIpLAogICAgICBsMiA9IHBvaW50cy5hdCgtMyksCiAgICAgIGwxID0gcG9pbnRzLmF0KC0yKSwKICAgICAgbDAgPSBwb2ludHMuYXQoLTEpLAogICAgICBsc20gPSBuZXcgVmVjdG9yKGwwLnggLyAyICsgbDIueCAvIDIsIGwwLnkgLyAyICsgbDIueSAvIDIpLAogICAgICBsMHIgPSBuZXcgVmVjdG9yKGwwKS5yZWZsZWN0KGwxKSwKICAgICAgbG4gPSBuZXcgVmVjdG9yKGwwci54IC8gMiArIGxzbS54IC8gMiwgbDByLnkgLyAyICsgbHNtLnkgLyAyKTsKICAgIGNwb2ludHMgPSBbZm4sIC4uLnBvaW50cywgbG5dOwogIH0KCiAgLy8gZm91ciBwb2ludCBzbGlkaW5nIHdpbmRvdyBvdmVyIHRoZSBzZWdtZW50CiAgc3RhcnQoKTsKICBfX2N0eC5tb3ZlVG8oY3BvaW50c1sxXS54LCBjcG9pbnRzWzFdLnkpOwogIGZvciAobGV0IGkgPSAwLCBlID0gY3BvaW50cy5sZW5ndGggLSAzOyBpIDwgZTsgaSsrKSB7CiAgICBsZXQgW2MxLCBjMiwgYzMsIGM0XSA9IGNwb2ludHMuc2xpY2UoaSwgaSArIDQpOwogICAgbGV0IHAyID0gewogICAgICB4OiBjMi54ICsgKGMzLnggLSBjMS54KSAvICg2ICogVCksCiAgICAgIHk6IGMyLnkgKyAoYzMueSAtIGMxLnkpIC8gKDYgKiBUKSwKICAgIH07CiAgICBsZXQgcDMgPSB7CiAgICAgIHg6IGMzLnggLSAoYzQueCAtIGMyLngpIC8gKDYgKiBUKSwKICAgICAgeTogYzMueSAtIChjNC55IC0gYzIueSkgLyAoNiAqIFQpLAogICAgfTsKICAgIF9fY3R4LmJlemllckN1cnZlVG8ocDIueCwgcDIueSwgcDMueCwgcDMueSwgYzMueCwgYzMueSk7CiAgfQogIGVuZCgpOwp9OwoKY29uc3Qgc3RhcnQgPSAoKSA9PiB7CiAgaWYgKF9fY3R4LmxpbmVXaWR0aCAlIDIgPT09IDEpIHsKICAgIF9fY3R4LnRyYW5zbGF0ZSgwLjUsIDAuNSk7CiAgfQogIF9fY3R4LmJlZ2luUGF0aCgpOwogIF9fZmlyc3QgPSBmYWxzZTsKfTsKCmNvbnN0IHRleHQgPSAoc3RyLCB4LCB5LCB4YWxpZ24sIHlhbGlnbiA9IGBpbmhlcml0YCkgPT4gewogIHNhdmUoKTsKICBpZiAoeGFsaWduKSB7CiAgICBzZXRUZXh0QWxpZ24oeGFsaWduLCB5YWxpZ24pOwogIH0KICBfX2N0eC5maWxsVGV4dChzdHIsIHgsIHkpOwogIGlmIChfX3RleHRTdHJva2UpIHsKICAgIHNldFN0cm9rZShfX3RleHRTdHJva2UpOwogICAgX19jdHguc3Ryb2tlVGV4dChzdHIsIHgsIHkpOwogIH0KICByZXN0b3JlKCk7Cn07Cgpjb25zdCB0cmlhbmdsZSA9ICh4MSwgeTEsIHgyLCB5MiwgeDMsIHkzKSA9PiB7CiAgc3RhcnQoKTsKICB2ZXJ0ZXgoeDEsIHkxKTsKICB2ZXJ0ZXgoeDIsIHkyKTsKICB2ZXJ0ZXgoeDMsIHkzKTsKICB2ZXJ0ZXgoeDEsIHkxKTsKICBlbmQoKTsKfTsKCmNvbnN0IHZlcnRleCA9ICh4LCB5KSA9PiB7CiAgaWYgKF9fZmlyc3QpIHsKICAgIF9fY3R4LmxpbmVUbyh4LCB5KTsKICB9IGVsc2UgewogICAgX19maXJzdCA9IHsgeCwgeSB9OwogICAgX19jdHgubW92ZVRvKHgsIHkpOwogIH0KfTsKCi8vIC0tLS0tLS0tLS0gdHJhbnNmb3JtIGZ1bmN0aW9ucyAtLS0tLS0tLS0tLS0tCgpjb25zdCByZXNldFRyYW5zZm9ybSA9ICgpID0+IHsKICBfX2N0eC5yZXNldFRyYW5zZm9ybSgpOwp9OwoKY29uc3Qgcm90YXRlID0gKGFuZ2xlID0gMCkgPT4gewogIF9fY3R4LnJvdGF0ZShhbmdsZSk7Cn07Cgpjb25zdCBzY2FsZSA9ICh4ID0gMSwgeSA9IHgpID0+IHsKICBfX2N0eC5zY2FsZSh4LCB5KTsKfTsKCmNvbnN0IHNjcmVlblRvV29ybGQgPSAoeCwgeSkgPT4gewogIGlmICh5ID09PSB1bmRlZmluZWQpIHsKICAgIHkgPSB4Lnk7CiAgICB4ID0geC54OwogIH0KCiAgbGV0IE0gPSBfX2N0eC5nZXRUcmFuc2Zvcm0oKS5pbnZlcnRTZWxmKCk7CgogIGxldCByZXQgPSB7CiAgICB4OiB4ICogTS5hICsgeSAqIE0uYyArIE0uZSwKICAgIHk6IHggKiBNLmIgKyB5ICogTS5kICsgTS5mLAogIH07CgogIHJldHVybiByZXQ7Cn07CgovKioKICogdHJhbnNmb3JtczogdW5pdmVyc2FsIGZyZWUgdHJhbnNmb3JtIGJhc2VkIG9uIGFwcGx5aW5nCiAqCiAqICAgICAgIHwgYSBiIGMgfAogKiAgIG0gPSB8IGQgZSBmIHwKICogICAgICAgfCAwIDAgMSB8CiAqLwpjb25zdCB0cmFuc2Zvcm0gPSAoYSA9IDEsIGIgPSAwLCBjID0gMCwgZCA9IDAsIGUgPSAxLCBmID0gMCkgPT4gewogIF9fY3R4LnRyYW5zZm9ybShhLCBiLCBjLCBkLCBlLCBmKTsKfTsKCmNvbnN0IHRyYW5zbGF0ZSA9ICh4ID0gMCwgeSA9IDApID0+IHsKICBfX2N0eC50cmFuc2xhdGUoeCwgeSk7Cn07Cgpjb25zdCB3b3JsZFRvU2NyZWVuID0gKHgsIHkpID0+IHsKICBpZiAoeSA9PT0gdW5kZWZpbmVkKSB7CiAgICB5ID0geC55OwogICAgeCA9IHgueDsKICB9CgogIGxldCBNID0gX19jdHguZ2V0VHJhbnNmb3JtKCk7CgogIGxldCByZXQgPSB7CiAgICB4OiB4ICogTS5hICsgeSAqIE0uYyArIE0uZSwKICAgIHk6IHggKiBNLmIgKyB5ICogTS5kICsgTS5mLAogIH07CgogIHJldHVybiByZXQ7Cn07CgovLyAtLS0tLS0tLS0tLS0tLS0tIHNldHRlcnMgLS0tLS0tLS0tLS0tLS0tLS0tLQoKY29uc3Qgc2V0Qm9yZGVyID0gKHdpZHRoID0gMSwgY29sb3IgPSBgYmxhY2tgKSA9PiB7CiAgaWYgKCF3aWR0aCkgewogICAgX19jYW52YXMuc3R5bGUuYm9yZGVyID0gYG5vbmVgOwogIH0gZWxzZSB7CiAgICBfX2NhbnZhcy5zdHlsZS5ib3JkZXIgPSBgJHt3aWR0aH1weCBzb2xpZCAke2NvbG9yfWA7CiAgfQp9OwoKY29uc3Qgc2V0Q29sb3IgPSAoY29sb3IpID0+IHsKICBzZXRGaWxsKGNvbG9yKTsKICBzZXRTdHJva2UoY29sb3IpOwp9OwoKY29uc3Qgc2V0Q3Jpc3AgPSAoZW5hYmxlZCA9IHRydWUpID0+IHsKICBfX2NhbnZhcy5jbGFzc0xpc3QudG9nZ2xlKGBjcmlzcGAsIGVuYWJsZWQpOwp9OwoKY29uc3Qgc2V0Q3Vyc29yID0gKHR5cGUpID0+IHsKICBfX2N1cnJlbnRfY3Vyc29yID0gdHlwZTsKICBfX2NhbnZhcy5zdHlsZS5jdXJzb3IgPSBfX2N1cnJlbnRfY3Vyc29yOwp9OwoKY29uc3Qgc2V0RmlsbCA9IChjb2xvciA9IGBibGFja2ApID0+IHsKICBpZiAoQ1NTX0NPTE9SX01BUFtjb2xvcl0gPT09IF9faGlnaGxpZ2h0X2NvbG9yKSB7CiAgICBjb2xvciA9IF9fY3VycmVudF9oaWdobGlnaHRfY29sb3I7CiAgfQogIF9fY3R4LmZpbGxTdHlsZSA9IGNvbG9yOwp9OwoKY29uc3Qgc2V0Rm9udCA9IChmb250KSA9PiB7CiAgX19jdHguZm9udCA9IGZvbnQgfHwgYCR7X19mb250LndlaWdodH0gJHtfX2ZvbnQuc2l6ZX1weCAke19fZm9udC5mYW1pbHl9YDsKfTsKCmNvbnN0IHNldEZvbnRGYW1pbHkgPSAobmFtZSkgPT4gewogIF9fZm9udC5mYW1pbHkgPSBuYW1lOwogIHNldEZvbnQoKTsKfTsKY29uc3Qgc2V0Rm9udFNpemUgPSAocHgpID0+IHsKICBfX2ZvbnQuc2l6ZSA9IHB4OwogIHNldEZvbnQoKTsKfTsKCmNvbnN0IHNldEZvbnRXZWlnaHQgPSAodmFsKSA9PiB7CiAgX19mb250LndlaWdodCA9IHZhbDsKICBzZXRGb250KCk7Cn07Cgpjb25zdCBzZXRHcmlkID0gKHNwYWNpbmcgPSAyMCwgY29sb3IgPSBgbGlnaHRncmV5YCkgPT4gewogIF9fZHJhd19ncmlkID0gdHJ1ZTsKICBfX2dyaWRfc3BhY2luZyA9IHNwYWNpbmc7CiAgX19ncmlkX2NvbG9yID0gY29sb3I7Cn07Cgpjb25zdCBzZXRIaWdobGlnaHRDb2xvciA9IChjb2xvcikgPT4gewogIF9fY3VycmVudF9oaWdobGlnaHRfY29sb3IgPSBjb2xvcjsKfTsKCmNvbnN0IHNldExpbmVEYXNoID0gKC4uLnZhbHVlcykgPT4gewogIF9fY3R4LnNldExpbmVEYXNoKHZhbHVlcyk7Cn07Cgpjb25zdCBzZXRMaW5lV2lkdGggPSAod2lkdGggPSAxKSA9PiB7CiAgX19jdHgubGluZVdpZHRoID0gd2lkdGg7Cn07Cgpjb25zdCBzZXRTdHJva2UgPSAoY29sb3IgPSBgYmxhY2tgKSA9PiB7CiAgaWYgKENTU19DT0xPUl9NQVBbY29sb3JdID09PSBfX2hpZ2hsaWdodF9jb2xvcikgewogICAgY29sb3IgPSBfX2N1cnJlbnRfaGlnaGxpZ2h0X2NvbG9yOwogIH0KICBfX2N0eC5zdHJva2VTdHlsZSA9IGNvbG9yOwp9OwoKY29uc3Qgc2V0VGV4dEFsaWduID0gKHhhbGlnbiwgeWFsaWduID0gQUxQSEFCRVRJQykgPT4gewogIF9fY3R4LnRleHRBbGlnbiA9IHhhbGlnbjsKICBfX2N0eC50ZXh0QmFzZUxpbmUgPSB5YWxpZ247Cn07Cgpjb25zdCBzZXRUZXh0RGlyZWN0aW9uID0gKGRpciA9IGBpbmhlcml0YCkgPT4gewogIF9fY3R4LmRpcmVjdGlvbiA9IGRpcjsKfTsKCmNvbnN0IHNldFRleHRTdHJva2UgPSAoY29sb3IsIHdpZHRoKSA9PiB7CiAgX190ZXh0U3Ryb2tlID0gY29sb3I7CiAgc2V0TGluZVdpZHRoKHdpZHRoKTsKfTsKCi8vIC0tLS0tLS0tLS0tLS0tLS0gIm5vIC4uLiIgLS0tLS0tLS0tLS0tLS0tLS0tLQoKY29uc3Qgbm9Cb3JkZXIgPSAoKSA9PiB7CiAgc2V0Qm9yZGVyKGZhbHNlKTsKfTsKCmNvbnN0IG5vQ29sb3IgPSAoKSA9PiB7CiAgbm9GaWxsKCk7CiAgbm9TdHJva2UoKTsKfTsKCmNvbnN0IG5vQ3Vyc29yID0gKCkgPT4gewogIF9fY2FudmFzLnN0eWxlLmN1cnNvciA9IGBub25lYDsKfTsKCmNvbnN0IG5vRmlsbCA9ICgpID0+IHsKICBzZXRGaWxsKGB0cmFuc3BhcmVudGApOwp9OwoKY29uc3Qgbm9HcmlkID0gKCkgPT4gewogIF9fZHJhd19ncmlkID0gZmFsc2U7Cn07Cgpjb25zdCBub0xpbmVEYXNoID0gKCkgPT4gewogIF9fY3R4LnNldExpbmVEYXNoKFtdKTsKfTsKCmNvbnN0IG5vTWFyZ2luZyA9ICgpID0+IHsKICBzZXRNYXJnaW4oMCk7Cn07Cgpjb25zdCBub1NoYWRvdyA9ICgpID0+IHsKICBzZXRTaGFkb3coYHRyYW5zcGFyZW50YCwgMCk7Cn07Cgpjb25zdCBub1N0cm9rZSA9ICgpID0+IHsKICBzZXRTdHJva2UoYHRyYW5zcGFyZW50YCk7Cn07Cgpjb25zdCBub1RleHRTdHJva2UgPSAoKSA9PiB7CiAgc2V0VGV4dFN0cm9rZShmYWxzZSwgdW5kZWZpbmVkKTsKfTsK"),y=class extends h{static{o(this,"GraphicsElement")}constructor(){super(),this.label=document.createElement("label"),this.title||(this.title=""),this.label.textContent=this.title}handleAttributeChange(...e){}handleChildChanges(...e){}connectedCallback(){super.connectedCallback(),k(this)?this.loadSource():new IntersectionObserver((e,r)=>e.forEach(x=>{x.isIntersecting&&(this.loadSource(),r.disconnect())}),{threshold:.1,rootMargin:`${window.innerHeight}px`}).observe(this)}getStyle(){return`:host([hidden]) { display: none; }
:host {
style { display: none; }
.top-title { display: flex; flex-direction: row; justify-content: space-between; }
canvas { touch-action: none; user-select: none; position: relative; z-index: 1; display: block; margin: auto; border-radius: 0; box-sizing: content-box !important; border: 1px solid lightgrey;
&.crisp { image-rendering: -moz-crisp-edges; image-rendering: -webkit-crisp-edges; image-rendering: pixelated; image-rendering: crisp-edges; }
&:focus { border: 1px solid red; }}
a { &.view-source { font-size: 60%; text-decoration: none;
&.plus { padding-left: 0.5em; }}}
button.reset { font-size: 0.5em; top: -0.35em; position: relative; }
label:not(:empty) { display: block; font-style: italic; font-size: 0.9em; text-align: right; padding-right: 1em; margin-top: 0.35em; }}`}async loadSource(e,r,x){r&&x&&(this.style.width=r,this.style.height=x);let t=0;if(!e){if(this.userCode)e=this.userCode;else{let g=this.getAttribute("src");g?e=await(await fetch(g)).text():e=`function setup() {
}
function draw() {
}
`}let s=this.querySelectorAll("source");t=s.length,t>0&&(s=await Promise.all(Array.from(s).map(g=>fetch(g.src).then(b=>b.text()))),e+=`
`+s.map((g,b)=>g.replace("function setup()",`function setup${b+1}()`).replace("function draw()",`function draw${b+1}()`))+`
function __more_setup() { ${[...new Array(t)].map((g,b)=>`setup${b+1}();`).join(`
`)} }
function __more_draw() { ${[...new Array(t)].map((g,b)=>`draw${b+1}();`).join(`
`)} }
`)}this.userCode=e;let i=e.matchAll(/addSlider\(['"`](.*)['"`]/g),l=[];for(let s of i)l.push(s[1]),e=e.replace(s[0],s[0]+`, (v) => (${s[1]} = v)`);l.length&&(e="let "+l.join(", ")+`;
`+e),e=e.replaceAll(/ from ['"].([^'"]+)['"]/g,` from "${H(location.href)}/$1"`);let $=this.getAttribute("width"),n=this.getAttribute("height");$&&n&&(e=e.replace("function setup() {",`function setup() {
  setSize(${$}, ${n});`)),import(`data:text/javascript;base64,${M([`import { BSpline, Point, Circle, Vector, Matrix, CSS_COLOR_MAP } from "${P}";`,`const __randomId = "${Date.now()}";`,_,e,"export { reset as start, __canvas as canvas, halt, highlight }"].join(`
`))}`).then(s=>{let{start:g,canvas:b,halt:E,highlight:u}=s;this.canvas=b,this.halt=()=>E(),this.highlight=p=>u(p),this.render(),r&&x&&(this.style.width="",this.style.height=""),g(this),this.dispatchEvent(new CustomEvent("load")),this.onload&&this.onload()})}reset(e){let{width:r,height:x}=this.halt();this.crosslinked=!1,this.querySelector("button.remove-color")?.remove(),this.loadSource(e||this.userCode,r,x)}render(){super.render();let e=this._slot.parentNode;this.canvas&&e.insertBefore(this.canvas,this._slot),this.label&&e.insertBefore(this.label,this._slot);let r=document.createElement("div");r.classList.add("top-title");let x=document.createElement("span");x.classList.add("sources"),r.append(x);let t=document.createElement("button");t.classList.add("reset"),t.textContent=this.getAttribute("reset")||"reset",t.addEventListener("click",()=>this.reset()),r.append(t);let i=this.getAttribute("src");if(i){let $=document.createElement("a");$.classList.add("view-source"),$.textContent=this.getAttribute("viewSource")||"view source",$.href=i,$.target="_blank",x.append($)}let l=this.querySelectorAll("source");l.length&&l.forEach(($,n)=>{let{src:f}=$,s=document.createElement("a");s.classList.add("view-source","plus"),s.textContent=`[+${n+1}]`,s.href=f,s.target="_blank",x.append(s)}),this.label&&e.insertBefore(r,this.canvas),this.crosslink()}crosslink(){if(this.crosslinked)return;this.crosslinked=!0;let e=!1;if(this.querySelectorAll("p").forEach(r=>{r.querySelectorAll("*").forEach(x=>{if(!D.includes(x.tagName))return;e=!0;let t;x.classList.remove("calm"),x.addEventListener("pointerenter",()=>{t??=getComputedStyle(x)["-webkit-text-stroke-color"],this.highlight(t)}),x.addEventListener("pointerleave",()=>this.highlight(!1))})}),e){let r=document.createElement("button");r.textContent="remove colors",r.classList.add("remove-color"),r.addEventListener("click",()=>{this.querySelectorAll("p").forEach(x=>{x.querySelectorAll("*").forEach(t=>{D.includes(t.tagName)&&t.classList.add("calm")})}),r.remove()}),this.append(r)}}};await h.register(y);export{A as BSpline,U as CSS_COLOR_MAP,N as Circle,R as Matrix,L as Point,m as Vector};
